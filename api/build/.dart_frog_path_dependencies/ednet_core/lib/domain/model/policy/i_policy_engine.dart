part of ednet_core;

/// Interface for policy engines that enforce domain rules and constraints.
///
/// A policy engine is responsible for:
/// - Managing collections of policies
/// - Evaluating which policies apply to specific entities
/// - Executing policy actions when triggered
/// - Generating commands based on policy evaluations
///
/// This interface ensures type safety and clear contracts for policy management
/// across the EDNet Core domain layer.
///
/// Example usage:
/// ```dart
/// class CustomPolicyEngine implements IPolicyEngine {
///   @override
///   void addPolicy(Policy policy) {
///     // Implementation specific logic
///   }
///
///   @override
///   List<Policy> getApplicablePolicies(Entity entity) {
///     // Return policies that apply to this entity
///   }
/// }
/// ```
abstract class IPolicyEngine {
  /// Adds a policy to the engine for evaluation and execution.
  ///
  /// Parameters:
  /// - [policy]: The policy to add to the engine
  ///
  /// Example:
  /// ```dart
  /// final policy = BusinessRulePolicy();
  /// policyEngine.addPolicy(policy);
  /// ```
  void addPolicy(IPolicy policy);

  /// Removes a policy from the engine.
  ///
  /// Parameters:
  /// - [policy]: The policy to remove from the engine
  ///
  /// Returns:
  /// True if the policy was found and removed, false otherwise
  bool removePolicy(IPolicy policy);

  /// Gets all policies that are applicable to the given entity.
  ///
  /// This method evaluates each policy's conditions to determine
  /// if it should be applied to the specific entity.
  ///
  /// Parameters:
  /// - [entity]: The entity to evaluate policies against
  ///
  /// Returns:
  /// A list of policies that apply to the entity
  ///
  /// Example:
  /// ```dart
  /// final applicablePolicies = policyEngine.getApplicablePolicies(customer);
  /// for (final policy in applicablePolicies) {
  ///   policy.evaluate(customer);
  /// }
  /// ```
  List<IPolicy> getApplicablePolicies(Entity entity);

  /// Executes all applicable policies for the given entity.
  ///
  /// This method:
  /// 1. Gets all applicable policies for the entity
  /// 2. Executes their actions
  /// 3. Collects any generated commands
  ///
  /// Parameters:
  /// - [entity]: The entity to execute policies against
  ///
  /// Returns:
  /// A list of commands generated by policy execution
  List<dynamic> executePolicies(Entity entity);

  /// Gets all policies currently managed by this engine.
  ///
  /// Returns:
  /// A read-only list of all policies in the engine
  List<IPolicy> get policies;

  /// Gets the domain session associated with this policy engine.
  ///
  /// Returns:
  /// The domain session, or null if not set
  IDomainSession? get session;
}
