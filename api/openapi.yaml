openapi: 3.0.3
info:
  title: SOM API
  version: 1.0.0
  description: REST API for the SOM platform (buyers, providers, consultants).
servers:
  - url: http://localhost:8081
    description: Local development

tags:
  - name: Auth
  - name: Companies
  - name: Users
  - name: Inquiries
  - name: Offers
  - name: Ads
  - name: Branches
  - name: Subscriptions
  - name: Consultants
  - name: Providers
  - name: Stats
  - name: Billing
  - name: Roles

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    ApiError:
      type: string
    Role:
      type: object
      required: [id, name]
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    RoleInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
    Product:
      type: object
      required: [id, companyId, name]
      properties:
        id:
          type: string
        companyId:
          type: string
        name:
          type: string
        createdAt:
          type: string
          format: date-time
    ProductInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
    ProviderProfile:
      type: object
      required: [companyId, bankDetails, branchIds, pendingBranchIds, subscriptionPlanId, paymentInterval, status]
      properties:
        companyId:
          type: string
        bankDetails:
          $ref: '#/components/schemas/BankDetails'
        branchIds:
          type: array
          items:
            type: string
        pendingBranchIds:
          type: array
          items:
            type: string
        subscriptionPlanId:
          type: string
        paymentInterval:
          type: string
        providerType:
          type: string
        status:
          type: string
        rejectionReason:
          type: string
        rejectedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Address:
      type: object
      required: [country, city, street, number, zip]
      properties:
        country:
          type: string
        city:
          type: string
        street:
          type: string
        number:
          type: string
        zip:
          type: string
    BankDetails:
      type: object
      required: [iban, bic, accountOwner]
      properties:
        iban:
          type: string
        bic:
          type: string
        accountOwner:
          type: string
    ProviderRegistrationData:
      type: object
      properties:
        bankDetails:
          $ref: '#/components/schemas/BankDetails'
        branchIds:
          type: array
          items:
            type: string
        subscriptionPlanId:
          type: string
        paymentInterval:
          type: integer
          enum: [0, 1]
          description: 0 = monthly, 1 = yearly
        providerType:
          type: string
    CompanyRegistration:
      type: object
      required: [name, address, uidNr, registrationNr, companySize, type, termsAccepted, privacyAccepted]
      properties:
        name:
          type: string
        address:
          $ref: '#/components/schemas/Address'
        uidNr:
          type: string
        registrationNr:
          type: string
        companySize:
          type: integer
          enum: [0, 1, 2, 3, 4, 5]
          description: 0=0-10, 1=11-50, 2=51-100, 3=101-250, 4=251-500, 5=500+
        type:
          type: integer
          enum: [0, 1, 2]
          description: 0=buyer, 1=provider, 2=buyer+provider
        websiteUrl:
          type: string
          format: uri
        providerData:
          $ref: '#/components/schemas/ProviderRegistrationData'
        termsAccepted:
          type: boolean
        privacyAccepted:
          type: boolean
    UserRegistration:
      type: object
      required: [email, firstName, lastName, salutation, roles]
      properties:
        email:
          type: string
          format: email
        firstName:
          type: string
        lastName:
          type: string
        salutation:
          type: string
        title:
          type: string
        telephoneNr:
          type: string
        roles:
          type: array
          items:
            type: integer
            enum: [0, 1, 2, 3, 4]
          description: 0=buyer,1=provider,2=buyer(default),3=consultant,4=admin
    RegisterCompanyRequest:
      type: object
      required: [company, users]
      properties:
        company:
          $ref: '#/components/schemas/CompanyRegistration'
        users:
          type: array
          items:
            $ref: '#/components/schemas/UserRegistration'
    CreateAdRequest:
      type: object
      required: [branchId, url, type, status]
      properties:
        type:
          type: string
        status:
          type: string
          enum: [draft]
          description: Must be draft; activate via /ads/{id}/activate
        branchId:
          type: string
        url:
          type: string
        imagePath:
          type: string
        headline:
          type: string
        description:
          type: string
        startDate:
          type: string
        endDate:
          type: string
        bannerDate:
          type: string
    CreateInquiryRequest:
      type: object
      required: [branchId, categoryId, deadline, deliveryZips, numberOfProviders]
      properties:
        branchId:
          type: string
        categoryId:
          type: string
        productTags:
          type: array
          items:
            type: string
        deadline:
          type: string
          format: date-time
        deliveryZips:
          type: array
          items:
            type: string
        numberOfProviders:
          type: integer
        description:
          type: string
        providerZip:
          type: string
        radiusKm:
          type: integer
        providerType:
          type: string
        providerCompanySize:
          type: string
        salutation:
          type: string
        title:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        telephone:
          type: string
        email:
          type: string
          format: email
    CompanyDto:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        address:
          $ref: '#/components/schemas/Address'
        uidNr:
          type: string
        registrationNr:
          type: string
        companySize:
          type: integer
        type:
          type: integer
        websiteUrl:
          type: string
          nullable: true
        status:
          type: string
    UserDto:
      type: object
      properties:
        id:
          type: string
        companyId:
          type: string
        email:
          type: string
          format: email
        firstName:
          type: string
        lastName:
          type: string
        salutation:
          type: string
        title:
          type: string
          nullable: true
        telephoneNr:
          type: string
          nullable: true
        roles:
          type: array
          items:
            type: integer
    ProviderCriteria:
      type: object
      properties:
        providerZip:
          type: string
          nullable: true
        radiusKm:
          type: integer
          nullable: true
        providerType:
          type: string
          nullable: true
        companySize:
          type: string
          nullable: true
    ContactInfo:
      type: object
      required: [companyName, salutation, title, firstName, lastName, telephone, email]
      properties:
        companyName:
          type: string
        salutation:
          type: string
        title:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        telephone:
          type: string
        email:
          type: string
          format: email
    Inquiry:
      type: object
      properties:
        id:
          type: string
        buyerCompanyId:
          type: string
        createdByUserId:
          type: string
        status:
          type: string
        branchId:
          type: string
        categoryId:
          type: string
        productTags:
          type: array
          items:
            type: string
        deadline:
          type: string
          format: date-time
        deliveryZips:
          type: array
          items:
            type: string
        numberOfProviders:
          type: integer
        description:
          type: string
          nullable: true
        pdfPath:
          type: string
          nullable: true
        summaryPdfPath:
          type: string
          nullable: true
        providerCriteria:
          $ref: '#/components/schemas/ProviderCriteria'
        contactInfo:
          $ref: '#/components/schemas/ContactInfo'
        notifiedAt:
          type: string
          format: date-time
          nullable: true
        assignedAt:
          type: string
          format: date-time
          nullable: true
        closedAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Offer:
      type: object
      properties:
        id:
          type: string
        inquiryId:
          type: string
        providerCompanyId:
          type: string
        status:
          type: string
        pdfPath:
          type: string
          nullable: true
        summaryPdfPath:
          type: string
          nullable: true
        forwardedAt:
          type: string
          format: date-time
          nullable: true
        resolvedAt:
          type: string
          format: date-time
          nullable: true
        buyerDecision:
          type: string
          nullable: true
        providerDecision:
          type: string
          nullable: true
    Ad:
      type: object
      properties:
        id:
          type: string
        companyId:
          type: string
        type:
          type: string
        status:
          type: string
        branchId:
          type: string
        url:
          type: string
          format: uri
        imagePath:
          type: string
        headline:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        startDate:
          type: string
          format: date-time
          nullable: true
        endDate:
          type: string
          format: date-time
          nullable: true
        bannerDate:
          type: string
          format: date-time
          nullable: true
    AdActivationRequest:
      type: object
      properties:
        startDate:
          type: string
          format: date-time
          nullable: true
        endDate:
          type: string
          format: date-time
          nullable: true
        bannerDate:
          type: string
          format: date-time
          nullable: true
    BranchesPostRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        status:
          type: string
    Branch:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        status:
          type: string
        categories:
          type: array
          items:
            $ref: '#/components/schemas/Category'
    Category:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        status:
          type: string
    SubscriptionPlan:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        sortPriority:
          type: integer
        isActive:
          type: boolean
        priceInSubunit:
          type: integer
        maxUsers:
          type: integer
          nullable: true
        setupFeeInSubunit:
          type: integer
          nullable: true
        bannerAdsPerMonth:
          type: integer
          nullable: true
        normalAdsPerMonth:
          type: integer
          nullable: true
        freeMonths:
          type: integer
          nullable: true
        commitmentPeriodMonths:
          type: integer
          nullable: true
        rules:
          type: array
          items:
            type: object
            properties:
              restriction:
                type: integer
              upperLimit:
                type: integer
        createdAt:
          type: string
          format: date-time
    SubscriptionPlanInput:
      type: object
      required: [title, sortPriority, priceInSubunit]
      properties:
        title:
          type: string
        sortPriority:
          type: integer
        isActive:
          type: boolean
        priceInSubunit:
          type: integer
        maxUsers:
          type: integer
          nullable: true
        setupFeeInSubunit:
          type: integer
          nullable: true
        bannerAdsPerMonth:
          type: integer
          nullable: true
        normalAdsPerMonth:
          type: integer
          nullable: true
        freeMonths:
          type: integer
          nullable: true
        commitmentPeriodMonths:
          type: integer
          nullable: true
        confirm:
          type: boolean
          description: Require explicit confirmation when updating plans with active subscribers.
        rules:
          type: array
          items:
            type: object
            properties:
              restriction:
                type: integer
              upperLimit:
                type: integer
    AuditLogEntry:
      type: object
      properties:
        id:
          type: string
        actorId:
          type: string
          nullable: true
        action:
          type: string
        entityType:
          type: string
        entityId:
          type: string
        metadata:
          type: object
          nullable: true
        createdAt:
          type: string
          format: date-time
    SubscriptionCurrent:
      type: object
      properties:
        subscription:
          type: object
          properties:
            companyId:
              type: string
            planId:
              type: string
            status:
              type: string
            paymentInterval:
              type: string
            startDate:
              type: string
              format: date-time
            endDate:
              type: string
              format: date-time
            createdAt:
              type: string
              format: date-time
        plan:
          $ref: '#/components/schemas/SubscriptionPlan'
    ProviderSummary:
      type: object
      properties:
        companyId:
          type: string
        companyName:
          type: string
        companySize:
          type: string
        providerType:
          type: string
        postcode:
          type: string
        branchIds:
          type: array
          items:
            type: string
        pendingBranchIds:
          type: array
          items:
            type: string
        branchAssignments:
          type: array
          items:
            $ref: '#/components/schemas/CompanyBranchAssignment'
        categoryAssignments:
          type: array
          items:
            $ref: '#/components/schemas/CompanyCategoryAssignment'
        status:
          type: string
        rejectionReason:
          type: string
          nullable: true
        rejectedAt:
          type: string
          format: date-time
          nullable: true
        claimed:
          type: boolean
        receivedInquiries:
          type: integer
        sentOffers:
          type: integer
        acceptedOffers:
          type: integer
        subscriptionPlanId:
          type: string
        paymentInterval:
          type: string
        iban:
          type: string
        bic:
          type: string
        accountOwner:
          type: string
        registrationDate:
          type: string
          format: date-time
    CompanyBranchAssignment:
      type: object
      properties:
        branchId:
          type: string
        branchName:
          type: string
        source:
          type: string
        confidence:
          type: number
          nullable: true
        status:
          type: string
    CompanyCategoryAssignment:
      type: object
      properties:
        categoryId:
          type: string
        categoryName:
          type: string
        branchId:
          type: string
        branchName:
          type: string
        source:
          type: string
        confidence:
          type: number
          nullable: true
        status:
          type: string
    CompanyTaxonomy:
      type: object
      properties:
        companyId:
          type: string
        branches:
          type: array
          items:
            $ref: '#/components/schemas/CompanyBranchAssignment'
        categories:
          type: array
          items:
            $ref: '#/components/schemas/CompanyCategoryAssignment'
    BillingRecord:
      type: object
      properties:
        id:
          type: string
        companyId:
          type: string
        amountInSubunit:
          type: integer
        currency:
          type: string
        status:
          type: string
        periodStart:
          type: string
          format: date-time
        periodEnd:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        paidAt:
          type: string
          format: date-time
          nullable: true
    SubscriptionCancellation:
      type: object
      properties:
        id:
          type: string
        companyId:
          type: string
        requestedByUserId:
          type: string
        reason:
          type: string
          nullable: true
        status:
          type: string
        requestedAt:
          type: string
          format: date-time
        effectiveEndDate:
          type: string
          format: date-time
          nullable: true
        resolvedAt:
          type: string
          format: date-time
          nullable: true

paths:
  /auth/login:
    post:
      tags: [Auth]
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: Tokens
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  refreshToken:
                    type: string
        '400':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /auth/changePassword:
    post:
      tags: [Auth]
      summary: Change password for authenticated user
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [currentPassword, newPassword, confirmPassword]
              properties:
                currentPassword:
                  type: string
                newPassword:
                  type: string
                confirmPassword:
                  type: string
      responses:
        '200':
          description: Changed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout and revoke session
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Logged out
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /auth/confirmEmail:
    get:
      tags: [Auth]
      summary: Confirm email registration token
      parameters:
        - in: query
          name: token
          required: true
          schema:
            type: string
        - in: query
          name: email
          required: true
          schema:
            type: string
            format: email
      responses:
        '200':
          description: Confirmed
        '400':
          description: Invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /auth/forgotPassword:
    post:
      tags: [Auth]
      summary: Send password reset email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: string
  /auth/resetPassword:
    post:
      tags: [Auth]
      summary: Reset password with token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, token, password, confirmPassword]
              properties:
                email:
                  type: string
                  format: email
                token:
                  type: string
                password:
                  type: string
                confirmPassword:
                  type: string
      responses:
        '200':
          description: OK
        '400':
          description: Invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /auth/switchRole:
    post:
      tags: [Auth]
      summary: Switch role for current user
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role]
              properties:
                role:
                  type: string
                companyId:
                  type: string
      responses:
        '200':
          description: New access token
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
        '401':
          description: Unauthorized
        '403':
          description: Role not allowed
  /Companies:
    get:
      tags: [Companies]
      summary: List companies
      parameters:
        - in: query
          name: type
          schema:
            type: string
            description: Filter by company type (buyer/provider)
      responses:
        '200':
          description: Companies
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CompanyDto'
    post:
      tags: [Companies]
      summary: Register buyer/provider company
      operationId: registerCompany
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterCompanyRequest'
      responses:
        '200':
          description: Registered
        '400':
          description: Invalid registration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /Companies/{companyId}:
    get:
      tags: [Companies]
      summary: Get company
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Company
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyDto'
        '404':
          description: Not found
    put:
      tags: [Companies]
      summary: Update company
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanyDto'
      responses:
        '200':
          description: Updated
        '400':
          description: Invalid company type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
    delete:
      tags: [Companies]
      summary: Deactivate company and users
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deactivated
        '404':
          description: Not found
  /Companies/{companyId}/activate:
    post:
      tags: [Companies]
      summary: Activate or reactivate company
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Activated
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /Companies/{companyId}/registerUser:
    post:
      tags: [Users]
      summary: Register a new user for a company
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistration'
      responses:
        '200':
          description: User created
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /Companies/{companyId}/users:
    get:
      tags: [Users]
      summary: List company users
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserDto'
  /Companies/{companyId}/users/{userId}:
    get:
      tags: [Users]
      summary: Get user
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDto'
        '404':
          description: Not found
    delete:
      tags: [Users]
      summary: Deactivate user
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deactivated
        '400':
          description: Admin constraint
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
  /Companies/{companyId}/users/{userId}/remove:
    post:
      tags: [Users]
      summary: Remove user from company
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Removed
        '400':
          description: Admin constraint
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
        '404':
          description: Not found
  /Companies/{companyId}/users/{userId}/update:
    put:
      tags: [Users]
      summary: Update user
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
        - in: path
          name: userId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserDto'
      responses:
        '200':
          description: Updated user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDto'
        '400':
          description: Admin constraint
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
  /Users/loadUserWithCompany:
    get:
      tags: [Users]
      summary: Load user and company details
      parameters:
        - in: query
          name: userId
          required: true
          schema:
            type: string
        - in: query
          name: companyId
          required: false
          schema:
            type: string
      responses:
        '200':
          description: User with company
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: string
                  salutation:
                    type: string
                  title:
                    type: string
                  firstName:
                    type: string
                  lastName:
                    type: string
                  telephoneNr:
                    type: string
                  emailAddress:
                    type: string
                  roles:
                    type: array
                    items:
                      type: string
                  activeRole:
                    type: string
                  companyId:
                    type: string
                  activeCompanyId:
                    type: string
                  companyName:
                    type: string
                  companyAddress:
                    $ref: '#/components/schemas/Address'
                  companyType:
                    type: integer
                    enum: [0, 1, 2]
                    description: 0=buyer, 1=provider, 2=buyer+provider
                  companyOptions:
                    type: array
                    items:
                      type: object
                      properties:
                        companyId:
                          type: string
                        companyName:
                          type: string
                        companyType:
                          type: integer
                          enum: [0, 1, 2]
                        roles:
                          type: array
                          items:
                            type: string
                        activeRole:
                          type: string
        '404':
          description: Not found
  /Users/{userId}/unlock:
    post:
      tags: [Users]
      summary: Unlock a user account
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Unlocked
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /Subscriptions:
    get:
      tags: [Subscriptions]
      summary: List subscription plans
      responses:
        '200':
          description: Plans
          content:
            application/json:
              schema:
                type: object
                properties:
                  subscriptions:
                    type: array
                    items:
                      $ref: '#/components/schemas/SubscriptionPlan'
    post:
      tags: [Subscriptions]
      summary: Create subscription plan
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubscriptionPlanInput'
      responses:
        '200':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionPlan'
        '400':
          description: Invalid
        '403':
          description: Forbidden
  /Subscriptions/plans/{planId}:
    get:
      tags: [Subscriptions]
      summary: Get subscription plan
      parameters:
        - in: path
          name: planId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Plan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionPlan'
        '404':
          description: Not found
    put:
      tags: [Subscriptions]
      summary: Update subscription plan
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: planId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubscriptionPlanInput'
      responses:
        '200':
          description: Updated
        '403':
          description: Forbidden
        '404':
          description: Not found
    delete:
      tags: [Subscriptions]
      summary: Delete subscription plan
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: planId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deleted
  /audit:
    get:
      tags: [Audit]
      summary: List audit log entries
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: limit
          required: false
          schema:
            type: integer
      responses:
        '200':
          description: Audit log entries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditLogEntry'
        '403':
          description: Forbidden
        '404':
          description: Not found
  /Subscriptions/current:
    get:
      tags: [Subscriptions]
      summary: Get current subscription
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Current subscription
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionCurrent'
        '404':
          description: Not found
  /Subscriptions/upgrade:
    post:
      tags: [Subscriptions]
      summary: Upgrade subscription plan
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [planId]
              properties:
                planId:
                  type: string
      responses:
        '200':
          description: Updated
        '403':
          description: Forbidden
  /Subscriptions/downgrade:
    post:
      tags: [Subscriptions]
      summary: Downgrade subscription plan
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [planId]
              properties:
                planId:
                  type: string
      responses:
        '200':
          description: Updated
        '400':
          description: Invalid
        '403':
          description: Forbidden
  /Subscriptions/cancel:
    post:
      tags: [Subscriptions]
      summary: Request subscription cancellation
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: Cancellation requested
  /Subscriptions/cancellations:
    get:
      tags: [Subscriptions]
      summary: List subscription cancellation requests
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: companyId
          schema:
            type: string
        - in: query
          name: status
          schema:
            type: string
      responses:
        '200':
          description: Cancellation requests
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SubscriptionCancellation'
  /Subscriptions/cancellations/{cancellationId}:
    put:
      tags: [Subscriptions]
      summary: Resolve cancellation request
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: cancellationId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
      responses:
        '200':
          description: Updated
  /billing:
    get:
      tags: [Billing]
      summary: List billing records
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: companyId
          schema:
            type: string
      responses:
        '200':
          description: Billing records
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BillingRecord'
    post:
      tags: [Billing]
      summary: Create billing record
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BillingRecord'
      responses:
        '200':
          description: Created
  /billing/{billingId}:
    put:
      tags: [Billing]
      summary: Update billing record
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: billingId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                paidAt:
                  type: string
                  format: date-time
      responses:
        '200':
          description: Updated
  /inquiries:
    get:
      tags: [Inquiries]
      summary: List inquiries
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
        - in: query
          name: branchId
          schema:
            type: string
        - in: query
          name: branch
          schema:
            type: string
        - in: query
          name: providerType
          schema:
            type: string
        - in: query
          name: providerSize
          schema:
            type: string
        - in: query
          name: createdFrom
          schema:
            type: string
            format: date-time
        - in: query
          name: createdTo
          schema:
            type: string
            format: date-time
        - in: query
          name: deadlineFrom
          schema:
            type: string
            format: date-time
        - in: query
          name: deadlineTo
          schema:
            type: string
            format: date-time
        - in: query
          name: editorIds
          schema:
            type: string
          description: Comma-separated list of editor user IDs (admin/consultant only)
        - in: query
          name: format
          schema:
            type: string
            enum: [json, csv]
      responses:
        '200':
          description: Inquiries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Inquiry'
            text/csv:
              schema:
                type: string
    post:
      tags: [Inquiries]
      summary: Create inquiry
      operationId: createInquiry
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInquiryRequest'
          multipart/form-data:
            schema:
              allOf:
                - $ref: '#/components/schemas/CreateInquiryRequest'
                - type: object
                  properties:
                    file:
                      type: string
                      format: binary
      responses:
        '200':
          description: Created inquiry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Inquiry'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '401':
          description: Unauthorized
  /inquiries/{inquiryId}:
    get:
      tags: [Inquiries]
      summary: Get inquiry
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Inquiry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Inquiry'
        '404':
          description: Not found
  /inquiries/{inquiryId}/pdf:
    get:
      tags: [Inquiries]
      summary: Download inquiry PDF (signed URL)
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Signed URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  signedUrl:
                    type: string
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not found
  /inquiries/{inquiryId}/pdf/generate:
    post:
      tags: [Inquiries]
      summary: Generate inquiry summary PDF
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Generated summary PDF
          content:
            application/json:
              schema:
                type: object
                properties:
                  summaryPdfPath:
                    type: string
                  signedUrl:
                    type: string
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not found
    post:
      tags: [Inquiries]
      summary: Upload inquiry PDF
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  pdfPath:
                    type: string
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
        '404':
          description: Not found
    delete:
      tags: [Inquiries]
      summary: Remove inquiry PDF
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Removed
        '403':
          description: Forbidden

  /offers/{offerId}/pdf:
    get:
      tags: [Offers]
      summary: Download offer PDF (signed URL)
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: offerId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Signed URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  signedUrl:
                    type: string
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not found
  /offers/{offerId}/pdf/generate:
    post:
      tags: [Offers]
      summary: Generate offer summary PDF
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: offerId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Generated summary PDF
          content:
            application/json:
              schema:
                type: object
                properties:
                  summaryPdfPath:
                    type: string
                  signedUrl:
                    type: string
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not found
  /inquiries/{inquiryId}/close:
    post:
      tags: [Inquiries]
      summary: Close inquiry
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Closed
        '403':
          description: Forbidden
        '404':
          description: Not found
  /inquiries/{inquiryId}/assign:
    post:
      tags: [Inquiries]
      summary: Assign inquiry to providers
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [providerCompanyIds]
              properties:
                providerCompanyIds:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Assigned
        '400':
          description: Invalid request
        '403':
          description: Forbidden
  /inquiries/{inquiryId}/ignore:
    post:
      tags: [Inquiries]
      summary: Provider ignores inquiry
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Ignored
        '403':
          description: Forbidden
  /inquiries/{inquiryId}/offers:
    get:
      tags: [Offers]
      summary: List offers for inquiry
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Offers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Offer'
    post:
      tags: [Offers]
      summary: Create offer for inquiry
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
          application/json:
            schema:
              type: object
              properties:
                pdfBase64:
                  type: string
      responses:
        '200':
          description: Created offer
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  status:
                    type: string
        '403':
          description: Forbidden
  /offers/{offerId}/accept:
    post:
      tags: [Offers]
      summary: Accept offer
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: offerId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Accepted
        '401':
          description: Unauthorized
        '404':
          description: Not found
  /offers/{offerId}/reject:
    post:
      tags: [Offers]
      summary: Reject offer
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: offerId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Rejected
        '401':
          description: Unauthorized
        '404':
          description: Not found
  /ads:
    get:
      tags: [Ads]
      summary: List ads
      description: Public calls return active ads. Use scope=company or scope=all with Bearer auth to list managed ads.
      parameters:
        - in: query
          name: branchId
          schema:
            type: string
        - in: query
          name: scope
          schema:
            type: string
            enum: [company, all]
          description: company = list ads for the authenticated company, all = list ads across companies (consultant only)
        - in: query
          name: companyId
          schema:
            type: string
          description: Optional company id when scope=all
        - in: query
          name: status
          schema:
            type: string
          description: Filter by ad status (e.g. active, draft, expired)
      responses:
        '200':
          description: Ads
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ad'
    post:
      tags: [Ads]
      summary: Create ad
      operationId: createAd
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAdRequest'
          multipart/form-data:
            schema:
              allOf:
                - $ref: '#/components/schemas/CreateAdRequest'
                - type: object
                  properties:
                    image:
                      type: string
                      format: binary
      responses:
        '200':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /ads/{adId}:
    get:
      tags: [Ads]
      summary: Get ad
      parameters:
        - in: path
          name: adId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Ad
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ad'
        '404':
          description: Not found
    put:
      tags: [Ads]
      summary: Update ad
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: adId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Ad'
      responses:
        '200':
          description: Updated
        '404':
          description: Not found
    delete:
      tags: [Ads]
      summary: Delete ad
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: adId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deleted
  /ads/{adId}/activate:
    post:
      tags: [Ads]
      summary: Activate ad
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: adId
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdActivationRequest'
      responses:
        '200':
          description: Activated
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
        '404':
          description: Not found
  /ads/{adId}/deactivate:
    post:
      tags: [Ads]
      summary: Deactivate ad
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: adId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deactivated
        '403':
          description: Forbidden
        '404':
          description: Not found
  /ads/{adId}/image:
    post:
      tags: [Ads]
      summary: Upload ad image
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: adId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Updated image
          content:
            application/json:
              schema:
                type: object
                properties:
                  imagePath:
                    type: string
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not found
  /branches:
    get:
      tags: [Branches]
      summary: List branches
      responses:
        '200':
          description: Branches
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Branch'
    post:
      tags: [Branches]
      summary: Create branch
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BranchesPostRequest'
      responses:
        '200':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Branch'
        '400':
          description: Exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
  /branches/{branchId}:
    put:
      tags: [Branches]
      summary: Update branch
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: branchId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BranchesPostRequest'
      responses:
        '200':
          description: Updated
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
        '404':
          description: Not found
    delete:
      tags: [Branches]
      summary: Delete branch
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: branchId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deleted
        '403':
          description: Forbidden
  /branches/{branchId}/categories:
    post:
      tags: [Branches]
      summary: Create category
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: branchId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BranchesPostRequest'
      responses:
        '200':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: Exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
  /categories/{categoryId}:
    put:
      tags: [Branches]
      summary: Update category
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: categoryId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BranchesPostRequest'
      responses:
        '200':
          description: Updated
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
        '404':
          description: Not found
    delete:
      tags: [Branches]
      summary: Delete category
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: categoryId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deleted
        '403':
          description: Forbidden
  /consultants:
    get:
      tags: [Consultants]
      summary: List consultants
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Consultants
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserDto'
        '403':
          description: Forbidden
    post:
      tags: [Consultants]
      summary: Create consultant
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistration'
      responses:
        '200':
          description: Created
        '400':
          description: Email exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /consultants/registerCompany:
    post:
      tags: [Consultants]
      summary: Consultant registers company (allow incomplete)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [company, users]
              properties:
                company:
                  $ref: '#/components/schemas/CompanyRegistration'
                users:
                  type: array
                  items:
                    $ref: '#/components/schemas/UserRegistration'
      responses:
        '200':
          description: Registered
        '400':
          description: Invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
  /providers/{companyId}/approve:
    post:
      tags: [Providers]
      summary: Approve provider branches
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                approvedBranchIds:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Approved
        '403':
          description: Forbidden
        '404':
          description: Not found
  /providers:
    get:
      tags: [Providers]
      summary: List providers with pagination
      description: Returns paginated list of providers with total count in headers.
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
            maximum: 200
          description: Number of results per page (max 200)
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
          description: Number of results to skip
        - in: query
          name: search
          schema:
            type: string
          description: Search by company name (case-insensitive)
        - in: query
          name: branchId
          schema:
            type: string
        - in: query
          name: categoryId
          schema:
            type: string
        - in: query
          name: companySize
          schema:
            type: string
        - in: query
          name: providerType
          schema:
            type: string
        - in: query
          name: zipPrefix
          schema:
            type: string
        - in: query
          name: status
          schema:
            type: string
        - in: query
          name: claimed
          schema:
            type: string
        - in: query
          name: format
          schema:
            type: string
          description: Use format=csv to export providers list.
      responses:
        '200':
          description: Provider list
          headers:
            X-Total-Count:
              schema:
                type: integer
              description: Total number of matching providers
            X-Has-More:
              schema:
                type: boolean
              description: Whether there are more results after this page
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProviderSummary'
            text/csv:
              schema:
                type: string
        '403':
          description: Forbidden
  /providers/{companyId}/taxonomy:
    get:
      tags: [Providers]
      summary: Get provider taxonomy assignments
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Provider taxonomy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyTaxonomy'
        '403':
          description: Forbidden
    put:
      tags: [Providers]
      summary: Replace provider taxonomy assignments
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                branchIds:
                  type: array
                  items:
                    type: string
                categoryIds:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Updated taxonomy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyTaxonomy'
        '403':
          description: Forbidden
  /providers/{companyId}/decline:
    post:
      tags: [Providers]
      summary: Decline provider branch request
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: Declined
        '403':
          description: Forbidden
        '404':
          description: Not found
  /stats/buyer:
    get:
      tags: [Stats]
      summary: Buyer statistics
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: userId
          schema:
            type: string
        - in: query
          name: format
          schema:
            type: string
            enum: [json, csv]
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                type: object
                properties:
                  open:
                    type: integer
                  closed:
                    type: integer
            text/csv:
              schema:
                type: string
        '403':
          description: Forbidden
  /stats/provider:
    get:
      tags: [Stats]
      summary: Provider statistics
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: type
          schema:
            type: string
            enum: [status, period, providerType, providerSize]
        - in: query
          name: format
          schema:
            type: string
            enum: [json, csv]
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                type: object
                properties:
                  open:
                    type: integer
                  offer_created:
                    type: integer
                  lost:
                    type: integer
                  won:
                    type: integer
                  ignored:
                    type: integer
            text/csv:
              schema:
                type: string
        '403':
          description: Forbidden
  /stats/consultant:
    get:
      tags: [Stats]
      summary: Consultant statistics
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: type
          schema:
            type: string
            enum: [status, period, providerType, providerSize]
        - in: query
          name: format
          schema:
            type: string
            enum: [json, csv]
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: integer
            text/csv:
              schema:
                type: string
        '403':
          description: Forbidden

  /roles:
    get:
      tags: [Roles]
      summary: List roles
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'
    post:
      tags: [Roles]
      summary: Create role
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleInput'
      responses:
        '200':
          description: Created role
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /roles/{roleId}:
    put:
      tags: [Roles]
      summary: Update role
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: roleId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleInput'
      responses:
        '200':
          description: Updated role
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    delete:
      tags: [Roles]
      summary: Delete role
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: roleId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deleted
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /providers/{companyId}:
    get:
      tags: [Providers]
      summary: Get provider profile
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Provider profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProviderProfile'
        '404':
          description: Not found

  /providers/{companyId}/paymentDetails:
    put:
      tags: [Providers]
      summary: Update provider payment details
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BankDetails'
      responses:
        '200':
          description: Updated payment details
          content:
            application/json:
              schema:
                type: object
                properties:
                  companyId:
                    type: string
                  bankDetails:
                    $ref: '#/components/schemas/BankDetails'
        '400':
          description: Validation error
        '403':
          description: Forbidden
        '404':
          description: Not found

  /providers/{companyId}/products:
    get:
      tags: [Providers]
      summary: List provider products
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Products
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
    post:
      tags: [Providers]
      summary: Create provider product
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        '200':
          description: Product created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'

  /providers/{companyId}/products/{productId}:
    put:
      tags: [Providers]
      summary: Update provider product
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
        - in: path
          name: productId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        '200':
          description: Updated product
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
    delete:
      tags: [Providers]
      summary: Delete provider product
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
        - in: path
          name: productId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deleted
