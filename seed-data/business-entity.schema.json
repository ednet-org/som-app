{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.local/schema/business-entity.schema.json",
  "title": "BusinessEntity",
  "type": "object",
  "additionalProperties": false,
  "required": ["id", "country", "name", "providerType", "companySize", "addresses", "provenance"],
  "properties": {
    "id": { "type": "string", "minLength": 5 },
    "country": { "const": "AT" },
    "name": { "type": "string", "minLength": 1 },
    "legalForm": { "type": "string" },
    "providerType": {
      "type": "string",
      "enum": ["HAENDLER", "HERSTELLER", "DIENSTLEISTER", "GROSSHAENDLER", "UNKNOWN"]
    },
    "companySize": {
      "type": "string",
      "enum": ["E0_10", "E11_50", "E51_100", "E101_250", "E251_500", "E500_PLUS", "UNKNOWN"]
    },
    "addresses": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["country"],
        "properties": {
          "country": { "const": "AT" },
          "postcode": { "type": "string", "pattern": "^[0-9]{4}$" },
          "city": { "type": "string" },
          "street": { "type": "string" },
          "houseNumber": { "type": "string" },
          "bundesland": {
            "type": "string",
            "enum": ["Wien", "Niederoesterreich", "Oberoesterreich", "Salzburg", "Tirol", "Vorarlberg", "Kaernten", "Steiermark", "Burgenland"]
          },
          "raw": { "type": "string" }
        }
      }
    },
    "geo": {
      "type": "object",
      "additionalProperties": false,
      "required": ["lat", "lon"],
      "properties": {
        "lat": { "type": "number", "minimum": 46.3, "maximum": 49.0 },
        "lon": { "type": "number", "minimum": 9.5, "maximum": 17.2 }
      }
    },
    "contacts": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "phones": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["value"],
            "properties": {
              "value": { "type": "string" },
              "type": { "type": "string", "enum": ["main", "mobile", "fax", "other"] },
              "sourceUrl": { "type": "string", "format": "uri" }
            }
          }
        },
        "emails": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["value"],
            "properties": {
              "value": { "type": "string", "format": "email" },
              "type": { "type": "string", "enum": ["general", "sales", "support", "other"] },
              "sourceUrl": { "type": "string", "format": "uri" }
            }
          }
        },
        "websites": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["value"],
            "properties": {
              "value": { "type": "string", "format": "uri" },
              "type": { "type": "string", "enum": ["main", "shop", "social", "other"] },
              "sourceUrl": { "type": "string", "format": "uri" }
            }
          }
        }
      }
    },
    "externalIds": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "osmNodeId": { "type": "string" },
        "osmWayId": { "type": "string" },
        "osmRelationId": { "type": "string" },
        "firmenbuchNr": { "type": "string", "pattern": "^FN [0-9]+[a-z]$" },
        "uidNr": { "type": "string", "pattern": "^ATU[0-9]{8}$" },
        "gln": { "type": "string" }
      }
    },
    "classification": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "osmTags": {
          "type": "object",
          "additionalProperties": { "type": "string" },
          "description": "Raw OSM tag key-value pairs"
        },
        "naceCodes": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["code"],
            "properties": {
              "code": { "type": "string", "pattern": "^[0-9]{2}(\\.[0-9]{1,2})?$" },
              "description": { "type": "string" },
              "primary": { "type": "boolean" }
            }
          }
        }
      }
    },
    "taxonomy": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "branchId": { "type": "string" },
        "branchName": { "type": "string" },
        "categoryId": { "type": "string" },
        "categoryName": { "type": "string" },
        "productTags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "inference": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "method": {
              "type": "string",
              "enum": ["osm_tag_mapping", "nace_mapping", "name_inference", "manual"]
            },
            "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
            "matchedTags": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        }
      }
    },
    "offering": { "type": "object" },
    "active": { "type": "boolean" },
    "provenance": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["sourceId"],
        "properties": {
          "sourceId": { "type": "string" },
          "sourceName": { "type": "string" },
          "sourceUrl": { "type": "string", "format": "uri" },
          "contactSourceUrl": { "type": "string", "format": "uri" },
          "fetchedAt": { "type": "string", "format": "date-time" },
          "license": { "type": "string" },
          "licenseUrl": { "type": "string", "format": "uri" },
          "fields": { "type": "array", "items": { "type": "string" } }
        }
      }
    },
    "confidence": { "type": "number", "minimum": 0, "maximum": 1 }
  }
}
